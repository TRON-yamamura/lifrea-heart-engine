name: Lifrea Heart Engine (update)

on:
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Call Lifrea Heart Script
        uses: actions/github-script@v6
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        with:
          script: |
            const res = await fetch(`https://api.notion.com/v1/pages`, {
              method: "POST",
              headers: {
                "Authorization": `Bearer ${process.env.NOTION_TOKEN}`,
                "Notion-Version": "2022-06-28",
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                parent: { database_id: process.env.NOTION_DATABASE_ID },
                properties: {
                  title: {
                    title: [{ text: { content: "GitHub Heartbeat" } }]
                  },
                  time_iso: { date: { start: new Date().toISOString() } },
                  hour: { number: new Date().getHours() },
                  weekday: { rich_text: [{ text: { content: new Date().toLocaleDateString('ja-JP', { weekday: 'short' }) } }] },
                  weather: { select: { name: "晴れ" } },
                  temp_c: { number: 22 },
                  mood_seed: { number: Math.floor(Math.random() * 100) }
                }
              }),
            });

            const data = await res.json();
            if (!res.ok) {
              core.setFailed(`Notion API error: ${res.status} ${data.message || ''}`);
            } else {
              core.info("✅ Data successfully sent to Notion!");
            }

